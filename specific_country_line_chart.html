<!--https://d3-graph-gallery.com/graph/basic_datamanipulation.html very good-->
<!--continuous colors for ordinal values?-->

<html lang="en-US">
	<head>
		<title>CS 416 Narrative Visualization Project</title>
		<script src='https://d3js.org/d3.v5.min.js'></script>
  	</head>
	<body onload='init()'>
		<!--
		<div>
			<h1 id="text">AAA</h1>
		</div>
		<div>
			<button onclick="changeText()" style="height:25px;width:50px" />
		</div>
		<br />
		-->
		<div>
			<svg id="svgForFertilityPlot" width=600 height=600></svg>
            <svg id="svgForMortalityPlot" width=600 height=600></svg>                 
		</div>
		
		<div>
			<a href="page3.html">Back to Scatterplot</a>
		</div>	
	</body>
	<script>
		// function init() {
        async function init() {
			// MY CODE: 
			
            var country = "Yemen, Rep."; // CHANGE!!!!



			// var data = d3.csv("project_2_scatterplot_data.csv");
			var data = await d3.csv("https://raw.githubusercontent.com/jbao8899/CS-416-Narrative-Visualization-Project/main/project_2_data.csv");
			
            // get rid of data for which fertility rate is missing
            data = data.filter(function(d) { return d.FertilityRate != "" })
            // get rid of data for which fertility rate or mortality rate under 5 are missing
            data = data.filter(function(d) { return d.FertilityRate != "" })
            data = data.filter(function(d) { return d.Under5DeathsPer1000 != "" })
            // keep only data for the specified country
            data = data.filter(function(d) { return d.CountryName == country})
            
            // Check that we have data for the country in question
            if (data.length == 0) {
                // for 2 lines
                d3.select("#svgForFertilityPlot")
                  .append("text")
                  .attr("class", "error message")
                  .attr("text-anchor", "middle")
                  .attr("x", 300)
                  .attr("y", 275)
                  .attr("font-size", "36px")
                  .text("Data not found for");
                d3.select("#svgForFertilityPlot")
                  .append("text")
                  .attr("class", "error message")
                  .attr("text-anchor", "middle")
                  .attr("x", 300)
                  .attr("y", 325)
                  .attr("font-size", "36px")
                  .text(country);
            }

            var xScale = d3.scaleLinear().domain([1960, 2021]).range([0, 400]);
            var yScaleFertility = d3.scaleLinear().domain([0, 9]).range([400, 0])
            var yScaleMortality = d3.scaleLinear().domain([0, 450]).range([400, 0])

            // consistent color scheme 
            // var colorScale = d3.scaleOrdinal()
            //                    .domain(["East Asia & Pacific",
            //                             "North America",
            //                             "Europe & Central Asia",
            //                             "Latin America & Caribbean",
            //                             "South Asia",
            //                             "Middle East & North Africa",
            //                             "Sub-Saharan Africa"])
            //                    .range(["purple",
            //                            "indigo",
            //                            "blue",
            //                            "lightblue",
            //                            "green",
            //                            "orange",
            //                            "red"]);
            // Above doesn't seem to work?
            var color;
            if (data[0].Region == "East Asia & Pacific") {
                color = "purple";
            }
            else if (data[0].Region == "North America") {
                color = "indigo";
            }
            else if (data[0].Region == "Europe & Central Asia") {
                color = "blue";
            }
            else if (data[0].Region == "Latin America & Caribbean") {
                color = "lightblue";
            }
            else if (data[0].Region == "South Asia") {
                color = "green";
            }
            else if (data[0].Region == "Middle East & North Africa") {
                color = "orange";
            }
            else { // Sub-Saharan Africa
                color = "red";
            }

            // https://d3-graph-gallery.com/graph/line_basic.html
            d3.select("#svgForFertilityPlot")
			  .attr("width", 400 + 2 * 100)
			  .attr("height", 400 + 2 * 100)
			  .append("g")
			  .attr("transform","translate(100, 100)")
              .append("path")
              .datum(data)
              .attr("fill", "none")
              .attr("stroke", color )
              .attr("stroke-width", 3)
              .attr("d",
                    d3.line()
                      .x(function(d) { return xScale(d.Year) })
                      .y(function(d) { return yScaleFertility(d.FertilityRate) })
              )

            d3.select("#svgForFertilityPlot")
			  .append("g")
			  .attr("transform", "translate(100, 100)")
			  .call(d3.axisLeft(yScaleFertility));
            
			d3.select("#svgForFertilityPlot")
			  .append("g")
			  .attr("transform", "translate(100, 500)")
			  .call(d3.axisBottom(xScale)
                      .tickFormat(d3.format("d")));

            // https://stackoverflow.com/questions/11189284/d3-axis-labeling
            d3.select("#svgForFertilityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 535)
              .attr("font-size", "18px")
              .text("Year");

            d3.select("#svgForFertilityPlot")
              .append("text")
              .attr("class", "y label")
              .attr("text-anchor", "middle")
              .attr("x", -300)
              .attr("y", 65)
              .attr("font-size", "18px")
              .attr("transform", "rotate(-90)")
              .text("Fertility Rate");

            d3.select("#svgForFertilityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 55)
              .attr("font-size", "24px")
              .text("Fertility Rate Over Time For");
            d3.select("#svgForFertilityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 85)
              .attr("font-size", "24px")
              .text(country);

            // https://d3-graph-gallery.com/graph/line_basic.html
            d3.select("#svgForMortalityPlot")
			  .attr("width", 400 + 2 * 100)
			  .attr("height", 400 + 2 * 100)
			  .append("g")
			  .attr("transform","translate(100, 100)")
              .append("path")
              .datum(data)
              .attr("fill", "none")
              .attr("stroke", color )
              .attr("stroke-width", 3)
              .attr("d",
                    d3.line()
                      .x(function(d) { return xScale(d.Year) })
                      .y(function(d) { return yScaleMortality(d.Under5DeathsPer1000) })
              )

            d3.select("#svgForMortalityPlot")
			  .append("g")
			  .attr("transform", "translate(100, 100)")
			  .call(d3.axisLeft(yScaleMortality));
            
			d3.select("#svgForMortalityPlot")
			  .append("g")
			  .attr("transform", "translate(100, 500)")
			  .call(d3.axisBottom(xScale)
                      .tickFormat(d3.format("d")));

            // https://stackoverflow.com/questions/11189284/d3-axis-labeling
            d3.select("#svgForMortalityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 535)
              .attr("font-size", "18px")
              .text("Year");

            d3.select("#svgForMortalityPlot")
              .append("text")
              .attr("class", "y label")
              .attr("text-anchor", "middle")
              .attr("x", -300)
              .attr("y", 65)
              .attr("font-size", "18px")
              .attr("transform", "rotate(-90)")
              .text("Deaths Under 5 Per 1,000 Live Births");

            d3.select("#svgForMortalityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 55)
              .attr("font-size", "24px")
              .text("Early Childhood Mortality Rate Over Time For");
            d3.select("#svgForMortalityPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 85)
              .attr("font-size", "24px")
              .text(country);

            // console.log(data)
		}
		/*
		function changeText() {
			if (document.getElementById("text").innerHTML == "AAA") {
				document.getElementById("text").innerHTML = "BBB";
			}
			else {
				document.getElementById("text").innerHTML = "AAA";
			}
		}
		*/
	</script>
</html>
