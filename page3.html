<html lang="en-US">
	<head>
		<title>CS 416 Narrative Visualization Project</title>
		<script src='https://d3js.org/d3.v5.min.js'></script>
  	</head>
	<body onload="init()">
		<!-- <div>
			<h1 id="text">Slide 3</h1>
		</div> -->

        <div>
			<svg id="svgForPlot" width=600 height=600></svg>

            <svg id="svgForLegend" height=375 width=300></svg>
		</div>

		<div>
			<a href="page2.html">Previous Slide</a>
		</div>
	</body>

	<script>
		// function init() {
        async function init() {
			// MY CODE: 
					
			// var data = d3.csv("project_2_scatterplot_data.csv");
			var data = await d3.csv("https://raw.githubusercontent.com/jbao8899/CS-416-Narrative-Visualization-Project/main/project_2_data.csv");
			
            // console.log(data.length)

            // making scatterplot for a certain year
            data = data.filter(function(d) { return d.Year == "2020" })
            // get rid of data for which fertility rate or mortality rate under 5 are missing
            data = data.filter(function(d) { return d.FertilityRate != "" })
            data = data.filter(function(d) { return d.Under5DeathsPer1000 != "" })

            // console.log(data.length)
            // console.log(d3.max(data, function(d) { return +d.value; }))

			var xScale = d3.scaleLinear().domain([0, 450]).range([0, 400])
			var yScale = d3.scaleLinear().domain([0, 9]).range([400, 0])
			
            // consistent color scheme 
            var colorScale = d3.scaleOrdinal()
                               .domain(["East Asia & Pacific",
                                        "North America",
                                        "Europe & Central Asia",
                                        "Latin America & Caribbean",
                                        "South Asia",
                                        "Middle East & North Africa",
                                        "Sub-Saharan Africa"])
                               .range(["purple",
                                       "indigo",
                                       "blue",
                                       "lightblue",
                                       "green",
                                       "orange",
                                       "red"]);

			d3.select("#svgForPlot")
			  .attr("width", 400 + 2 * 100)
			  .attr("height", 400 + 2 * 100)
			  .append("g")
			  .attr("transform","translate(100, 100)")
			  .selectAll("circle")
			  .data(data)
			  .enter()
			  .append("circle")
			  .attr("cx", function(d) { return xScale(d.Under5DeathsPer1000); })
			  .attr("cy", function(d) { return yScale(d.FertilityRate); })
			  .attr("r", 5)
              .style("fill", function(d) {return colorScale(d.Region);});
					  
			d3.select("#svgForPlot")
			  .append("g")
			  .attr("transform", "translate(100, 100)")
			  .call(d3.axisLeft(yScale));
            
			d3.select("#svgForPlot")
			  .append("g")
			  .attr("transform", "translate(100, 500)")
			  .call(d3.axisBottom(xScale));
            
            // https://stackoverflow.com/questions/11189284/d3-axis-labeling
            d3.select("#svgForPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 535)
              .attr("font-size", "18px")
              .text("Deaths Under 5 Per 1,000 Live Births");

            d3.select("#svgForPlot")
              .append("text")
              .attr("class", "y label")
              .attr("text-anchor", "middle")
              .attr("x", -300)
              .attr("y", 65)
              .attr("font-size", "18px")
              .attr("transform", "rotate(-90)")
              .text("Fertility Rate");

            d3.select("#svgForPlot")
              .append("text")
              .attr("class", "x label")
              .attr("text-anchor", "middle")
              .attr("x", 300)
              .attr("y", 85)
              .attr("font-size", "24px")
              .text("Early Childhood Mortality Rate vs Fertility Rate (2020)");

            // Legend
            // https://d3-graph-gallery.com/graph/custom_legend.html (Categorical legend: square)
            // select the svg area
            var svgForLegend = d3.select("#svgForLegend")

            // create a list of keys
            var keys = ["East Asia & Pacific",
                        "North America",
                        "Europe & Central Asia",
                        "Latin America & Caribbean",
                        "South Asia",
                        "Middle East & North Africa",
                        "Sub-Saharan Africa"]

            // Usually you have a color scale in your chart already
            // var color = d3.scaleOrdinal()
            //     .domain(keys)
            //     .range(d3.schemeSet1);
            // I already have a colorscale

            // Add one dot in the legend for each name.
            var size = 20
            svgForLegend.selectAll("mydots")
                        .data(keys)
                        .enter()
                        .append("rect")
                        .attr("x", 100)
                        .attr("y", function(d,i){ return i*(size+5)}) // 100 is where the first dot appears. 25 is the distance between dots
                        .attr("width", size)
                        .attr("height", size)
                        .style("fill", function(d){ return colorScale(d)})

            // Add one dot in the legend for each name.
            svgForLegend.selectAll("mylabels")
                        .data(keys)
                        .enter()
                        .append("text")
                        .attr("x", 100 + size*1.2)
                        .attr("y", function(d,i){ return i*(size+5) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots
                        .style("fill", function(d){ return colorScale(d)})
                        .text(function(d){ return d})
                        .attr("text-anchor", "left")
                        .style("alignment-baseline", "middle")
            // console.log(data)
		}

		/*
		function changeText() {
			if (document.getElementById("text").innerHTML == "AAA") {
				document.getElementById("text").innerHTML = "BBB";
			}
			else {
				document.getElementById("text").innerHTML = "AAA";
			}
		}
		*/
	</script>
</html>
